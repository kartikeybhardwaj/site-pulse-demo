import{d as We,g as Fe,c as ve,a as q,s as Qe,f as C,b as T,e as Re}from"../chunks/CQx0q4k3.js";import{l as Be,c as ue,X as Se,p as Ue,y as Xe,a6 as Ze,a7 as je,a8 as ze,R as Ge,U as Je,S as d,T as Ke,a1 as De,e as t,V as et,Y as a,Z as r,W as u,$ as tt,_ as o,a2 as Y,a0 as at}from"../chunks/QCr8S_d5.js";import{i as ce}from"../chunks/afW7fTtA.js";import{e as st,i as lt}from"../chunks/D0M3cO9m.js";import{h as nt,r as m,a as rt,s as ot}from"../chunks/CbCIeqGS.js";import{s as it,i as vt,t as $}from"../chunks/NuMtav88.js";import{b as D,a as A}from"../chunks/BKpjlwVq.js";import{g as Me}from"../chunks/u8Pq6ae7.js";function qe(n,c,M=!1){if(n.multiple){if(c==null)return;if(!Xe(c))return Ze();for(var b of n.options)b.selected=c.includes(H(b));return}for(b of n.options){var k=H(b);if(je(k,c)){b.selected=!0;return}}(!M||c!==void 0)&&(n.selectedIndex=-1)}function ut(n){var c=new MutationObserver(()=>{qe(n,n.__value)});c.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ze(()=>{c.disconnect()})}function ct(n,c,M=c){var b=new WeakSet,k=!0;Be(n,"change",p=>{var g=p?"[selected]":":checked",h;if(n.multiple)h=[].map.call(n.querySelectorAll(g),H);else{var v=n.querySelector(g)??n.querySelector("option:not([disabled])");h=v&&H(v)}M(h),ue!==null&&b.add(ue)}),Se(()=>{var p=c();if(n===document.activeElement){var g=Ue??ue;if(b.has(g))return}if(qe(n,p,k),k&&p===void 0){var h=n.querySelector(":checked");h!==null&&(p=H(h),M(p))}n.__value=p,k=!1}),ut(n)}function H(n){return"__value"in n?n.__value:n.value}var pt=C('<button type="button" class="remove-btn svelte-1ax4549">×</button>'),dt=C('<div class="option-group svelte-1ax4549"><div class="option-row svelte-1ax4549"><input type="text" maxlength="140" class="svelte-1ax4549"/> <span class="char-count svelte-1ax4549"> </span> <!></div> <input type="url" class="link-input svelte-1ax4549" placeholder="Link (optional)"/></div>'),ft=C('<button type="button" class="add-btn svelte-1ax4549">+ Add option</button>'),mt=C('<label class="svelte-1ax4549"><span class="svelte-1ax4549">Start <small>(optional — leave empty to start immediately)</small></span> <input type="text" placeholder="YYYY-MM-DD HH:MM" maxlength="16" class="dt-input svelte-1ax4549"/></label> <label class="svelte-1ax4549"><span class="svelte-1ax4549">End <small>(required)</small></span> <input type="text" placeholder="YYYY-MM-DD HH:MM" maxlength="16" class="dt-input svelte-1ax4549"/></label>',1),xt=C('<label class="svelte-1ax4549"><span class="svelte-1ax4549">Voting duration</span> <select><option>1 hour</option><option>6 hours</option><option>24 hours</option><option>7 days</option><option>30 days</option><option>4 months</option></select></label>'),_t=C('<div class="page svelte-1ax4549"><h1 class="svelte-1ax4549">Create Poll</h1> <form class="svelte-1ax4549"><label class="svelte-1ax4549"><span class="svelte-1ax4549">Question <small> </small></span> <input type="text" placeholder="What do you want to ask?" maxlength="140"/></label> <label class="svelte-1ax4549"><span class="svelte-1ax4549">Description <small> </small></span> <input type="text" placeholder="Brief context for voters" maxlength="160"/></label> <label class="svelte-1ax4549"><span class="svelte-1ax4549">Question Link <small>(optional)</small></span> <input type="url" placeholder="https://..."/></label> <fieldset class="svelte-1ax4549"><legend class="svelte-1ax4549">Options</legend> <!> <!></fieldset> <fieldset class="svelte-1ax4549"><legend class="svelte-1ax4549">Schedule</legend> <label class="toggle svelte-1ax4549"><span class="svelte-1ax4549"><strong class="svelte-1ax4549">Custom schedule</strong> <small class="svelte-1ax4549">Set specific start and end times</small></span> <input type="checkbox" class="svelte-1ax4549"/> <span class="pill svelte-1ax4549"></span></label> <!> <small class="hint svelte-1ax4549">All poll data is automatically deleted 6 months after creation.</small></fieldset> <fieldset class="toggles svelte-1ax4549"><legend class="svelte-1ax4549">Privacy</legend> <label class="toggle svelte-1ax4549"><span class="svelte-1ax4549"><strong class="svelte-1ax4549">Private Poll</strong> <small class="svelte-1ax4549">Only accessible via direct link — hidden from Recent</small></span> <input type="checkbox" class="svelte-1ax4549"/> <span class="pill svelte-1ax4549"></span></label> <label class="toggle svelte-1ax4549"><span class="svelte-1ax4549"><strong class="svelte-1ax4549">Anonymous Creator</strong> <small class="svelte-1ax4549">Hide your identity from voters</small></span> <input type="checkbox" class="svelte-1ax4549"/> <span class="pill svelte-1ax4549"></span></label> <label class="toggle svelte-1ax4549"><span class="svelte-1ax4549"><strong class="svelte-1ax4549">Anonymous Voters</strong> <small class="svelte-1ax4549">Hide who voted for what from everyone</small></span> <input type="checkbox" class="svelte-1ax4549"/> <span class="pill svelte-1ax4549"></span></label> <label><span class="svelte-1ax4549"><strong class="svelte-1ax4549">Visible Voters</strong> <small class="svelte-1ax4549">Show who voted for each option</small></span> <input type="checkbox" class="svelte-1ax4549"/> <span class="pill svelte-1ax4549"></span></label></fieldset> <button type="submit" class="submit-btn svelte-1ax4549"> </button></form></div>');function Mt(n,c){Ge(c,!0);const M=()=>Re(vt,"$isLoggedIn",b),[b,k]=Qe();Je(()=>{M()||Me("/")});let p=d(""),g=d(""),h=d(""),v=d(Ke([{text:"",link:""},{text:"",link:""}])),N=d("24h"),y=d(!1),L=d(""),P=d("");function Ye(){const e=new Date,s=e.getMinutes(),l=Math.ceil((s+1)/15)*15,i=new Date(e);i.setSeconds(0,0),i.setMinutes(l);const f=new Date(i.getTime()+864e5);u(L,pe(i),!0),u(P,pe(f),!0)}function pe(e){const s=l=>String(l).padStart(2,"0");return`${e.getFullYear()}-${s(e.getMonth()+1)}-${s(e.getDate())} ${s(e.getHours())}:${s(e.getMinutes())}`}function O(e){if(!e||e.length<16)return null;const s=new Date(e.replace(" ","T"));return isNaN(s)?null:Math.floor(s.getTime()/1e3)}let W=d(!1),S=d(!1),F=d(!1),Q=d(!1),E=d(!1);function Ce(){t(v).length<5&&u(v,[...t(v),{text:"",link:""}],!0)}function Le(e){t(v).length>2&&u(v,t(v).filter((s,l)=>l!==e),!0)}async function Pe(){const e=t(v).filter(s=>s.text.trim());if(!t(p).trim()||e.length<2){$.add("Need a question and at least 2 options","error");return}if(t(y)){const s=Date.now()/1e3,l=O(t(L)),i=O(t(P));if(l&&l<s){$.add("Start time cannot be in the past","error");return}if(!i){$.add("End time is required","error");return}if(i>s+10368e3){$.add("End time cannot be more than 4 months from now","error");return}if(l&&i<=l){$.add("End time must be after start time","error");return}}u(E,!0);try{const s=await rt.createPoll({question:t(p).trim(),description:t(g).trim()||void 0,questionLink:t(h).trim()||void 0,options:e.map(l=>l.text.trim()),optionLinks:e.map(l=>l.link.trim()),expiry:t(y)?void 0:t(N)||void 0,startsAt:t(y)?O(t(L)):void 0,endsAt:t(y)?O(t(P)):void 0,anonCreator:t(W),anonVoters:t(S),visibleVoters:!t(S)&&t(F),private:t(Q)});$.add("Poll created!","success"),Me(`/p/${s.pollId}`)}catch(s){$.add(s.message,"error")}finally{u(E,!1)}}var R=_t();nt("1ax4549",e=>{Se(()=>{tt.title="Pulse — Create"})});var B=a(r(R),2),U=r(B),X=r(U),de=a(r(X)),Ve=r(de);o(de),o(X);var fe=a(X,2);m(fe),o(U);var Z=a(U,2),j=r(Z),me=a(r(j)),Ae=r(me);o(me),o(j);var xe=a(j,2);m(xe),o(Z);var z=a(Z,2),_e=a(r(z),2);m(_e),o(z);var G=a(z,2),be=a(r(G),2);st(be,17,()=>t(v),lt,(e,s,l)=>{var i=dt(),f=r(i),x=r(f);m(x),ot(x,"placeholder",`Option ${l+1}`);var _=a(x,2),V=r(_);o(_);var I=a(_,2);{var ie=w=>{var $e=pt();ve("click",$e,()=>Le(l)),q(w,$e)};ce(I,w=>{t(v).length>2&&w(ie)})}o(f);var we=a(f,2);m(we),o(i),De(()=>T(V,`${140-t(v)[l].text.length} left`)),D(x,()=>t(v)[l].text,w=>t(v)[l].text=w),D(we,()=>t(v)[l].link,w=>t(v)[l].link=w),q(e,i)});var He=a(be,2);{var Oe=e=>{var s=ft();ve("click",s,Ce),q(e,s)};ce(He,e=>{t(v).length<5&&e(Oe)})}o(G);var J=a(G,2),K=a(r(J),2),ee=a(r(K),2);m(ee),Y(2),o(K);var Ee=a(K,2);{var Ie=e=>{var s=mt(),l=at(s),i=a(r(l),2);m(i),o(l);var f=a(l,2),x=a(r(f),2);m(x),o(f),D(i,()=>t(L),_=>u(L,_)),D(x,()=>t(P),_=>u(P,_)),q(e,s)},Te=e=>{var s=xt(),l=a(r(s),2),i=r(l);i.value=i.__value="1h";var f=a(i);f.value=f.__value="6h";var x=a(f);x.value=x.__value="24h";var _=a(x);_.value=_.__value="7d";var V=a(_);V.value=V.__value="30d";var I=a(V);I.value=I.__value="4mo",o(l),o(s),ct(l,()=>t(N),ie=>u(N,ie)),q(e,s)};ce(Ee,e=>{t(y)?e(Ie):e(Te,!1)})}Y(2),o(J);var te=a(J,2),ae=a(r(te),2),he=a(r(ae),2);m(he),Y(2),o(ae);var se=a(ae,2),ge=a(r(se),2);m(ge),Y(2),o(se);var le=a(se,2),ye=a(r(le),2);m(ye),Y(2),o(le);var ne=a(le,2);let ke;var re=a(r(ne),2);m(re),Y(2),o(ne),o(te);var oe=a(te,2),Ne=r(oe,!0);o(oe),o(B),o(R),De(()=>{T(Ve,`(${140-t(p).length} chars left)`),T(Ae,`(optional, ${160-t(g).length} chars left)`),ke=it(ne,1,"toggle svelte-1ax4549",null,ke,{disabled:t(S)}),re.disabled=t(S),oe.disabled=t(E),T(Ne,t(E)?"Creating…":"Create Poll")}),Fe("submit",B,e=>{e.preventDefault(),Pe()}),D(fe,()=>t(p),e=>u(p,e)),D(xe,()=>t(g),e=>u(g,e)),D(_e,()=>t(h),e=>u(h,e)),ve("change",ee,()=>{t(y)&&Ye()}),A(ee,()=>t(y),e=>u(y,e)),A(he,()=>t(Q),e=>u(Q,e)),A(ge,()=>t(W),e=>u(W,e)),A(ye,()=>t(S),e=>u(S,e)),A(re,()=>t(F),e=>u(F,e)),q(n,R),et(),k()}We(["click","change"]);export{Mt as component};
