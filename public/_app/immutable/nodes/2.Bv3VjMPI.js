import{d as oa,a as n,s as ia,f as u,b as m,t as na,c as T,e as va}from"../chunks/CQx0q4k3.js";import{R as la,S as M,T as ua,U as ca,V as da,W as d,X as ga,$ as fa,Y as h,Z as g,e as a,_ as v,a0 as ha,a1 as V}from"../chunks/QCr8S_d5.js";import{i as p}from"../chunks/afW7fTtA.js";import{e as U,i as _a}from"../chunks/D0M3cO9m.js";import{h as ma,a as k,s as pa}from"../chunks/CbCIeqGS.js";import{t as C,s as W,i as ya}from"../chunks/NuMtav88.js";var xa=u('<p class="muted svelte-1uha8ag">Loading…</p>'),$a=u('<a href="/new" class="svelte-1uha8ag">Create the first one →</a>'),ba=u('<div class="empty svelte-1uha8ag"><span class="empty-icon svelte-1uha8ag">◉</span> <p class="svelte-1uha8ag">No polls yet</p> <!></div>'),Va=u("<span> </span>"),wa=u("<button> </button>"),Ma=u('<div class="quick-options svelte-1uha8ag"></div>'),ka=u('<div class="card svelte-1uha8ag"><div class="card-header svelte-1uha8ag"><a class="question svelte-1uha8ag"> </a> <span class="meta svelte-1uha8ag"> <!> <!></span></div> <!></div>'),La=u('<button class="load-more svelte-1uha8ag"> </button>'),Ia=u('<div class="poll-list svelte-1uha8ag"></div> <!>',1),Pa=u('<div class="page svelte-1uha8ag"><h1 class="svelte-1uha8ag">Recent Polls</h1> <!></div>');function Na(X,Y){la(Y,!0);const R=()=>va(ya,"$isLoggedIn",Z),[Z,z]=ia();let l=M(ua([])),A=M(!0),y=M(null),x=M(!1);ca(async()=>{try{const t=await k.getPolls("recent");d(l,t.polls,!0),d(y,t.nextCursor,!0)}catch(t){C.add(t.message,"error")}finally{d(A,!1)}});async function B(){if(!(!a(y)||a(x))){d(x,!0);try{const t=await k.getPolls("recent",a(y));d(l,[...a(l),...t.polls],!0),d(y,t.nextCursor,!0)}catch(t){C.add(t.message,"error")}finally{d(x,!1)}}}async function E(t,s){try{const $=a(l).find(r=>r.pollId===t)?.myVote===s?null:s;d(l,a(l).map(r=>r.pollId===t?{...r,myVote:$}:r),!0),await k.vote(t,s);const c=await k.getPoll(t);d(l,a(l).map(r=>r.pollId===t?{...r,myVote:c.myVote,results:c.results,totalVotes:c.totalVotes}:r),!0)}catch(f){C.add(f.message,"error")}}function F(t){if(!t)return"";const s=Math.floor(Date.now()/1e3)-t;return s<60?"just now":s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:`${Math.floor(s/86400)}d ago`}var L=Pa();ma("1uha8ag",t=>{ga(()=>{fa.title="Pulse — Recent"})});var G=h(g(L),2);{var H=t=>{var s=xa();n(t,s)},J=t=>{var s=ba(),f=h(g(s),4);{var $=c=>{var r=$a();n(c,r)};p(f,c=>{R()&&c($)})}v(s),n(t,s)},K=t=>{var s=Ia(),f=ha(s);U(f,21,()=>a(l),r=>r.pollId,(r,e)=>{var b=ka(),I=g(b),w=g(I),O=g(w,!0);v(w);var j=h(w,2),D=g(j),N=h(D);{var Q=o=>{var i=na();V(()=>m(i,`· ${a(e).totalVotes??""} vote${a(e).totalVotes!==1?"s":""}`)),n(o,i)};p(N,o=>{a(e).totalVotes&&o(Q)})}var aa=h(N,2);{var ta=o=>{var i=Va(),P=g(i,!0);v(i),V(()=>{W(i,1,`badge ${a(e).status??""}`,"svelte-1uha8ag"),m(P,a(e).status)}),n(o,i)};p(aa,o=>{a(e).status!=="active"&&o(ta)})}v(j),v(I);var ea=h(I,2);{var sa=o=>{var i=Ma();U(i,21,()=>a(e).options,_a,(P,q)=>{var _=wa();let S;var ra=g(_,!0);v(_),V(()=>{S=W(_,1,"option-btn svelte-1uha8ag",null,S,{voted:a(e).myVote===a(q)}),_.disabled=!R(),m(ra,a(q))}),T("click",_,()=>E(a(e).pollId,a(q))),n(P,_)}),v(i),n(o,i)};p(ea,o=>{a(e).status==="active"&&o(sa)})}v(b),V(o=>{pa(w,"href",`/p/${a(e).pollId??""}`),m(O,a(e).question),m(D,`${a(e).creator??""} · ${o??""} `)},[()=>F(a(e).createdAt)]),n(r,b)}),v(f);var $=h(f,2);{var c=r=>{var e=La(),b=g(e,!0);v(e),V(()=>{e.disabled=a(x),m(b,a(x)?"Loading…":"Load more")}),T("click",e,B),n(r,e)};p($,r=>{a(y)&&r(c)})}n(t,s)};p(G,t=>{a(A)?t(H):a(l).length===0?t(J,1):t(K,!1)})}v(L),n(X,L),da(),z()}oa(["click"]);export{Na as component};
