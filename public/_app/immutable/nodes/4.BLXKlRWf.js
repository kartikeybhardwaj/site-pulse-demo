import{d as O,a as r,s as Q,f as n,e as aa,b as k,c as y}from"../chunks/CQx0q4k3.js";import{R as ta,U as D,S as P,T as ea,V as sa,X as oa,W as l,$ as la,Y as g,Z as v,e as t,_ as i,a0 as ra,a1 as R}from"../chunks/QCr8S_d5.js";import{i as L}from"../chunks/afW7fTtA.js";import{e as ia}from"../chunks/D0M3cO9m.js";import{h as na,a as I,s as ca}from"../chunks/CbCIeqGS.js";import{t as p,i as da,s as va}from"../chunks/NuMtav88.js";import{g as ua}from"../chunks/u8Pq6ae7.js";var pa=n('<p class="muted svelte-1hzazio">Loading…</p>'),fa=n(`<div class="empty svelte-1hzazio"><span class="empty-icon svelte-1hzazio">◉</span> <p class="svelte-1hzazio">You haven't created any polls</p> <a href="/new" class="svelte-1hzazio">Create your first poll →</a></div>`),ha=n('<button class="btn-sm svelte-1hzazio">Close</button>'),ma=n('<button class="btn-sm svelte-1hzazio">Reopen</button>'),za=n('<div class="card svelte-1hzazio"><a class="question svelte-1hzazio"> </a> <div class="card-footer svelte-1hzazio"><span> </span> <div class="actions svelte-1hzazio"><!> <button class="btn-sm danger svelte-1hzazio">Delete</button></div></div></div>'),ga=n('<button class="load-more svelte-1hzazio"> </button>'),_a=n('<div class="poll-list svelte-1hzazio"></div> <!>',1),ba=n('<div class="page svelte-1hzazio"><h1 class="svelte-1hzazio">My Polls</h1> <!></div>');function wa(Y,S){ta(S,!0);const T=()=>aa(da,"$isLoggedIn",U),[U,V]=Q();D(()=>{T()||ua("/")});let o=P(ea([])),$=P(!0),f=P(null),h=P(!1);D(async()=>{try{const a=await I.getPolls("mine");l(o,a.polls,!0),l(f,a.nextCursor,!0)}catch(a){p.add(a.message,"error")}finally{l($,!1)}});async function W(){if(!(!t(f)||t(h))){l(h,!0);try{const a=await I.getPolls("mine",t(f));l(o,[...t(o),...a.polls],!0),l(f,a.nextCursor,!0)}catch(a){p.add(a.message,"error")}finally{l(h,!1)}}}async function w(a){try{const e=await I.closePoll(a);l(o,t(o).map(c=>c.pollId===a?{...c,status:e.status}:c),!0),p.add(e.status==="closed"?"Poll closed":"Poll reopened","success")}catch(e){p.add(e.message,"error")}}async function X(a){if(confirm("Delete this poll?"))try{await I.deletePoll(a),l(o,t(o).filter(e=>e.pollId!==a),!0),p.add("Poll deleted","success")}catch(e){p.add(e.message,"error")}}var x=ba();na("1hzazio",a=>{oa(()=>{la.title="Pulse — My Polls"})});var Z=g(v(x),2);{var j=a=>{var e=pa();r(a,e)},A=a=>{var e=fa();r(a,e)},B=a=>{var e=_a(),c=ra(e);ia(c,21,()=>t(o),d=>d.pollId,(d,s)=>{var m=za(),_=v(m),G=v(_,!0);i(_);var C=g(_,2),b=v(C),H=v(b,!0);i(b);var M=g(b,2),q=v(M);{var J=u=>{var z=ha();y("click",z,()=>w(t(s).pollId)),r(u,z)},K=u=>{var z=ma();y("click",z,()=>w(t(s).pollId)),r(u,z)};L(q,u=>{t(s).status==="active"?u(J):t(s).status==="closed"&&u(K,1)})}var N=g(q,2);i(M),i(C),i(m),R(()=>{ca(_,"href",`/p/${t(s).pollId??""}`),k(G,t(s).question),va(b,1,`badge ${t(s).status??""}`,"svelte-1hzazio"),k(H,t(s).status)}),y("click",N,()=>X(t(s).pollId)),r(d,m)}),i(c);var E=g(c,2);{var F=d=>{var s=ga(),m=v(s,!0);i(s),R(()=>{s.disabled=t(h),k(m,t(h)?"Loading…":"Load more")}),y("click",s,W),r(d,s)};L(E,d=>{t(f)&&d(F)})}r(a,e)};L(Z,a=>{t($)?a(j):t(o).length===0?a(A,1):a(B,!1)})}i(x),r(Y,x),sa(),V()}O(["click"]);export{wa as component};
