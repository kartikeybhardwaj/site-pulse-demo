import{d as Ae,h as De,a as d,e as Nt,s as Me,f as c,b as p,c as P}from"../chunks/CQx0q4k3.js";import{h as zt,ap as Ee,R as Oe,S as g,T as mt,U as Ce,ar as Re,aj as Se,e as t,W as i,a0 as A,V as Te,as as Qe,$ as je,Z as v,_ as n,Y as r,a1 as _,at as j}from"../chunks/QCr8S_d5.js";import{i as f}from"../chunks/afW7fTtA.js";import{e as qt,i as Ft}from"../chunks/D0M3cO9m.js";import{a as S,h as Be,r as lt,s as rt}from"../chunks/CbCIeqGS.js";import{a as $e,t as x,s as Ne,i as ze}from"../chunks/NuMtav88.js";import{b as nt}from"../chunks/BKpjlwVq.js";import{g as Ut}from"../chunks/u8Pq6ae7.js";function Fe(L,b,At,it){var vt=L.__style;if(zt||vt!==b){var Y=$e(b);(!zt||Y!==L.getAttribute("style"))&&(Y==null?L.removeAttribute("style"):L.style.cssText=Y),L.__style=b}return it}function Ue({params:L}){return{pollId:L.pollId}}const Va=Object.freeze(Object.defineProperty({__proto__:null,load:Ue},Symbol.toStringTag,{value:"Module"})),We=Ee(null);var Ye=c('<p class="muted svelte-1s02yfi">Loadingâ€¦</p>'),Ze=c('<div class="not-found svelte-1s02yfi"><span class="nf-icon svelte-1s02yfi">â—‰</span> <h2 class="svelte-1s02yfi">Poll not found</h2> <p class="svelte-1s02yfi">This poll may have been deleted or the link is invalid.</p> <a href="/" class="nf-link svelte-1s02yfi">â† Back to Recent</a></div>'),Ge=c('<div class="edit-option svelte-1s02yfi"><input type="text" maxlength="140"/> <input type="url" class="link-input svelte-1s02yfi" placeholder="Link (optional)"/></div>'),He=c('<div class="edit-form svelte-1s02yfi"><h1 class="svelte-1s02yfi">Edit Poll</h1> <label class="svelte-1s02yfi"><span class="svelte-1s02yfi">Question</span> <input type="text" maxlength="140"/></label> <label class="svelte-1s02yfi"><span class="svelte-1s02yfi">Description</span> <input type="text" maxlength="160" placeholder="Brief context for voters"/></label> <label class="svelte-1s02yfi"><span class="svelte-1s02yfi">Question Link</span> <input type="url" placeholder="https://..."/></label> <!> <div class="edit-actions svelte-1s02yfi"><button class="btn-primary svelte-1s02yfi"> </button> <button class="btn-secondary svelte-1s02yfi">Cancel</button></div></div>'),Je=c('<a target="_blank" rel="noopener" class="q-link svelte-1s02yfi">ğŸ”—</a>'),Ke=c('<p class="description svelte-1s02yfi"> </p>'),Xe=c("<span>Â·</span> <span> </span>",1),ta=c("<span>Â·</span> <span> </span>",1),ea=c("<span>Â·</span> <span> </span>",1),aa=c('<span class="badge svelte-1s02yfi">ğŸ”’ Anonymous creator</span>'),sa=c('<span class="badge svelte-1s02yfi">ğŸ”— Private</span>'),oa=c('<span class="badge svelte-1s02yfi">ğŸ”’ Anonymous votes</span>'),la=c('<span class="badge svelte-1s02yfi">ğŸ‘¤ Voters visible</span>'),ra=c('<span class="badge status svelte-1s02yfi"> </span>'),na=c('<span class="check svelte-1s02yfi">âœ“</span>'),ia=c('<a target="_blank" rel="noopener" class="opt-link svelte-1s02yfi">ğŸ”—</a>'),va=c('<span class="voter svelte-1s02yfi"> </span>'),da=c('<button class="voter-more svelte-1s02yfi"> </button>'),ca=c('<div class="voter-list svelte-1s02yfi"><!> <!></div>'),ua=c('<button class="voter-toggle svelte-1s02yfi"> </button> <!>',1),pa=c('<div class="result-wrapper svelte-1s02yfi"><button><div class="bar svelte-1s02yfi"></div> <div class="result-content svelte-1s02yfi"><span class="option-label svelte-1s02yfi"> <!></span> <span class="count svelte-1s02yfi"> </span></div></button> <!></div> <!>',1),fa=c('<button class="btn-secondary svelte-1s02yfi">Edit</button> <button class="btn-secondary svelte-1s02yfi"> </button>',1),_a=c('<button class="btn-secondary svelte-1s02yfi"> </button>'),ya=c('<!> <button class="btn-danger svelte-1s02yfi"> </button>',1),ba=c('<div class="header svelte-1s02yfi"><h1 class="svelte-1s02yfi"> <!></h1> <!> <div class="meta svelte-1s02yfi"><span> </span> <span>Â·</span> <span> </span> <!> <!></div> <div class="badges svelte-1s02yfi"><!> <!> <!> <!></div></div> <div class="results svelte-1s02yfi"></div> <div class="actions svelte-1s02yfi"><button class="btn-secondary svelte-1s02yfi">Copy link</button> <!></div>',1),ga=c('<div class="poll-page svelte-1s02yfi"><!></div>');function qa(L,b){Oe(b,!0);const At=()=>Nt(We,"$wsData",vt),it=()=>Nt(ze,"$isLoggedIn",vt),[vt,Y]=Me();let a=g(null),D=g(null),ht=g(!0),Z=g(mt({})),kt=g(mt({}));Ce(async()=>{try{i(a,await S.getPoll(b.data.pollId),!0),i(D,t(a).myVote,!0),b.data.pollId}catch{}finally{i(ht,!1)}}),Re(()=>void 0);let xt=g(!1);Se(()=>{const o=At();!o||!t(a)||t(xt)||((o.type==="update"||o.type==="reset")&&(S.getPoll(b.data.pollId).then(l=>{i(D,l.myVote,!0),i(a,l,!0)}),o.type==="reset"&&x.add("Poll was edited â€” votes have been reset","info")),o.type==="deleted"&&(x.add("Poll was deleted","error"),Ut("/")))});async function Wt(o){i(D,t(D)===o?null:o,!0),i(xt,!0);try{await S.vote(b.data.pollId,o);const l=await S.getPoll(b.data.pollId);i(D,l.myVote,!0),i(a,l,!0)}catch(l){x.add(l.message,"error")}finally{i(xt,!1)}}let y=g("");async function Dt(){i(y,"toggle");try{const o=await S.closePoll(b.data.pollId);i(a,{...t(a),status:o.status},!0),x.add(o.status==="closed"?"Poll closed":"Poll reopened","success")}catch(o){x.add(o.message,"error")}finally{i(y,"")}}let dt=g(!1),G=g(""),ct=g(""),ut=g(""),H=g(mt([])),pt=g(mt([]));function Yt(){i(G,t(a).question,!0),i(ct,t(a).description||"",!0),i(ut,t(a).questionLink||"",!0),i(H,[...t(a).options],!0),i(pt,t(a).results.map(o=>o.link||""),!0),i(dt,!0)}async function Zt(){const o=t(H).map(l=>l.trim()).filter(Boolean);if(!t(G).trim()||o.length<2){x.add("Need question and at least 2 options","error");return}i(y,"save");try{const l=await S.editPoll(b.data.pollId,{question:t(G).trim(),description:t(ct).trim()||void 0,questionLink:t(ut).trim()||void 0,options:o,optionLinks:t(pt).slice(0,o.length)});i(a,await S.getPoll(b.data.pollId),!0),i(D,t(a).myVote,!0),i(dt,!1),x.add(l.votesReset?"Poll updated â€” votes were reset":"Poll updated","success")}catch(l){x.add(l.message,"error")}finally{i(y,"")}}async function Gt(){if(confirm("Delete this poll?")){i(y,"delete");try{await S.deletePoll(b.data.pollId),x.add("Poll deleted","success"),Ut("/")}catch(o){x.add(o.message,"error"),i(y,"")}}}function Ht(o){i(Z,{...t(Z),[o]:!t(Z)[o]},!0)}function Jt(o,l){return l>0?Math.round(o/l*100):0}function J(o){if(!o)return null;const l=o-Math.floor(Date.now()/1e3);return l<=0?"Expired":l<3600?`${Math.floor(l/60)}m`:l<86400?`${Math.floor(l/3600)}h`:l<2592e3?`${Math.floor(l/86400)}d`:`${Math.floor(l/2592e3)}mo`}function Kt(){navigator.clipboard.writeText(window.location.href),x.add("Link copied!","success")}var Mt=De();Be("1s02yfi",o=>{Qe(l=>{je.title=l??""},[()=>t(a)?`Pulse â€” ${t(a).question.slice(0,50)}`:t(ht)?"Pulse":"Pulse â€” Not Found"])});var Xt=A(Mt);{var te=o=>{var l=Ye();d(o,l)},ee=o=>{var l=Ze();d(o,l)},ae=o=>{var l=ga(),se=v(l);{var oe=B=>{var $=He(),T=r(v($),2),N=r(v(T),2);lt(N),n(T);var z=r(T,2),ft=r(v(z),2);lt(ft),n(z);var K=r(z,2),X=r(v(K),2);lt(X),n(K);var _t=r(K,2);qt(_t,17,()=>t(H),Ft,(V,Pt,Q)=>{var et=Ge(),U=v(et);lt(U),rt(U,"placeholder",`Option ${Q+1}`);var yt=r(U,2);lt(yt),n(et),nt(U,()=>t(H)[Q],at=>t(H)[Q]=at),nt(yt,()=>t(pt)[Q],at=>t(pt)[Q]=at),d(V,et)});var F=r(_t,2),I=v(F),wt=v(I,!0);n(I);var tt=r(I,2);n(F),n($),_(()=>{I.disabled=t(y)==="save",p(wt,t(y)==="save"?"Savingâ€¦":"Save")}),nt(N,()=>t(G),V=>i(G,V)),nt(ft,()=>t(ct),V=>i(ct,V)),nt(X,()=>t(ut),V=>i(ut,V)),P("click",I,Zt),P("click",tt,()=>i(dt,!1)),d(B,$)},le=B=>{var $=ba(),T=A($),N=v(T),z=v(N),ft=r(z);{var K=s=>{var e=Je();_(()=>{rt(e,"href",t(a).questionLink),rt(e,"data-tooltip",t(a).questionLink)}),d(s,e)};f(ft,s=>{t(a).questionLink&&s(K)})}n(N);var X=r(N,2);{var _t=s=>{var e=Ke(),u=v(e,!0);n(e),_(()=>p(u,t(a).description)),d(s,e)};f(X,s=>{t(a).description&&s(_t)})}var F=r(X,2),I=v(F),wt=v(I,!0);n(I);var tt=r(I,4),V=v(tt);n(tt);var Pt=r(tt,2);{var Q=s=>{var e=Xe(),u=r(A(e),2),m=v(u);n(u),_(w=>p(m,`ğŸ• starts in ${w??""}`),[()=>J(t(a).startsAt)]),d(s,e)},et=s=>{var e=ta(),u=r(A(e),2),m=v(u);n(u),_(w=>p(m,`â³ ${w??""} to vote`),[()=>J(t(a).expiresAt)]),d(s,e)},U=j(()=>J(t(a).expiresAt));f(Pt,s=>{t(a).status==="scheduled"&&t(a).startsAt?s(Q):t(U)&&s(et,1)})}var yt=r(Pt,2);{var at=s=>{var e=ea(),u=r(A(e),2),m=v(u);n(u),_(w=>p(m,`ğŸ—‘ï¸ ${w??""} to auto-delete`),[()=>J(t(a).deletesAt)]),d(s,e)},re=j(()=>J(t(a).deletesAt));f(yt,s=>{t(re)&&s(at)})}n(F);var Et=r(F,2),Ot=v(Et);{var ne=s=>{var e=aa();d(s,e)};f(Ot,s=>{t(a).anonCreator&&s(ne)})}var Ct=r(Ot,2);{var ie=s=>{var e=sa();d(s,e)};f(Ct,s=>{t(a).private&&s(ie)})}var Rt=r(Ct,2);{var ve=s=>{var e=oa();d(s,e)},de=s=>{var e=la();d(s,e)};f(Rt,s=>{t(a).anonVoters?s(ve):t(a).visibleVoters&&s(de,1)})}var ce=r(Rt,2);{var ue=s=>{var e=ra(),u=v(e,!0);n(e),_(()=>p(u,t(a).status)),d(s,e)};f(ce,s=>{t(a).status!=="active"&&s(ue)})}n(Et),n(T);var Lt=r(T,2);qt(Lt,21,()=>t(a).results,s=>s.option,(s,e)=>{const u=j(()=>Jt(t(e).count,t(a).totalVotes)),m=j(()=>t(a).status==="active"&&it());var w=pa(),M=A(w),E=v(M);let q;var h=v(E),O=r(h,2),C=v(O),bt=v(C),_e=r(bt);{var ye=k=>{var R=na();d(k,R)};f(_e,k=>{t(D)===t(e).option&&k(ye)})}n(C);var Qt=r(C,2),be=v(Qt);n(Qt),n(O),n(E);var ge=r(E,2);{var me=k=>{var R=ia();_(()=>{rt(R,"href",t(e).link),rt(R,"data-tooltip",t(e).link)}),d(k,R)};f(ge,k=>{t(e).link&&k(me)})}n(M);var he=r(M,2);{var ke=k=>{var R=ua(),gt=A(R),xe=v(gt);n(gt);var we=r(gt,2);{var Pe=It=>{const Le=j(()=>t(kt)[t(e).option]?t(e).voters.length:10),jt=j(()=>t(e).voters.slice(0,t(Le))),Bt=j(()=>t(e).voters.length-t(jt).length);var Vt=ca(),$t=v(Vt);qt($t,17,()=>t(jt),Ft,(st,W)=>{var ot=va(),qe=v(ot,!0);n(ot),_(()=>p(qe,t(W))),d(st,ot)});var Ie=r($t,2);{var Ve=st=>{var W=da(),ot=v(W);n(W),_(()=>p(ot,`+${t(Bt)??""} more`)),P("click",W,()=>i(kt,{...t(kt),[t(e).option]:!0},!0)),d(st,W)};f(Ie,st=>{t(Bt)>0&&st(Ve)})}n(Vt),d(It,Vt)};f(we,It=>{t(Z)[t(e).option]&&It(Pe)})}_(()=>p(xe,`${t(Z)[t(e).option]?"â–¾":"â–¸"}
							${t(e).voters.length??""} voter${t(e).voters.length!==1?"s":""}`)),P("click",gt,()=>Ht(t(e).option)),d(k,R)};f(he,k=>{t(e).voters&&t(e).voters.length>0&&k(ke)})}_(()=>{q=Ne(E,1,"result-row svelte-1s02yfi",null,q,{voted:t(D)===t(e).option,clickable:t(m)}),E.disabled=!t(m),Fe(h,`width: ${t(u)??""}%`),p(bt,`${t(e).option??""} `),p(be,`${t(e).count??""} (${t(u)??""}%)`)}),P("click",E,()=>t(m)&&Wt(t(e).option)),d(s,w)}),n(Lt);var St=r(Lt,2),Tt=v(St),pe=r(Tt,2);{var fe=s=>{var e=ya(),u=A(e);{var m=q=>{var h=fa(),O=A(h),C=r(O,2),bt=v(C,!0);n(C),_(()=>{O.disabled=!!t(y),C.disabled=!!t(y),p(bt,t(y)==="toggle"?"Closingâ€¦":"Close poll")}),P("click",O,Yt),P("click",C,Dt),d(q,h)},w=q=>{var h=_a(),O=v(h,!0);n(h),_(()=>{h.disabled=!!t(y),p(O,t(y)==="toggle"?"Reopeningâ€¦":"Reopen poll")}),P("click",h,Dt),d(q,h)};f(u,q=>{t(a).status==="active"?q(m):t(a).status==="closed"&&q(w,1)})}var M=r(u,2),E=v(M,!0);n(M),_(()=>{M.disabled=!!t(y),p(E,t(y)==="delete"?"Deletingâ€¦":"Delete")}),P("click",M,Gt),d(s,e)};f(pe,s=>{t(a).isOwner&&it()&&s(fe)})}n(St),_(()=>{p(z,`${t(a).question??""} `),p(wt,t(a).creator),p(V,`${t(a).totalVotes??""} vote${t(a).totalVotes!==1?"s":""}`)}),P("click",Tt,Kt),d(B,$)};f(se,B=>{t(dt)?B(oe):B(le,!1)})}n(l),d(o,l)};f(Xt,o=>{t(ht)?o(te):t(a)?o(ae,!1):o(ee,1)})}d(L,Mt),Te(),Y()}Ae(["click"]);export{qa as component,Va as universal};
